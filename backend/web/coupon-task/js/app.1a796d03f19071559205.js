webpackJsonp([1],{NHnr:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("VCXJ"),l=o("zO6J"),s=o("aozt"),n=o.n(s),i={data:function(e){var t=function(e,t,o){if(!t)return o(new Error("手机号码不能为空"));setTimeout(function(){/^[1][3,4,5,6,7,8,9][0-9]{9}$/.test(t)?o():o(new Error("手机号格式不对"))},200)};return{myListData:{},taskId:"",files:[],filesBlack:[],checkStatus:0,sendTimePickerOption:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},uploadData:{dataType:"0",oldFilePath:""},uploadBlackData:{dataType:"0",oldFilePath:""},uploadActionUrl:rootCoffeeStieUrl+"task-api/verify-file.html",submitFormUrl:rootCoffeeStieUrl+"task-api/coupon-send-task-create.html",userSelectTaskUrl:rootCoffeeStieUrl+"task-api/get-selection-task-id-to-name-new-list.html",checkLegalUrl:"/user-selection-task/check-legal",getCouponUrl:"/coupon-send-task/get-valid-coupon-group",getCouponIdsUrl:"/coupon-send-task/get-valid-coupon",labelPosition:"right",form:{taskName:"",sendTime:"",couponGroupId:"",couponType:"",couponGradient:[{id:"",num:"1"}],userSelectionTask:"",phoneNumbersTextArea:[],blacklistphoneNumTextArea:[]},sendTimeFormat:"",userPhoneForm:{importUserPhone:""},blackPhoneForm:{sheildUserPhone:""},couponGroupOptions:[],couponGroupIdsOptions:[],userSelectTaskOptions:[],phoneListData:[],blackPhoneListData:[],uploadTxtCallbackInfo:"",uploadBlackTxtCallbackInfo:"",mobileUrl:"",blackMobileUrl:"",submitFlag:!0,rules:{taskName:[{required:!0,message:"请输入发券任务名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"},{validator:function(e,t,o){setTimeout(function(){new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]").test(t)?o(new Error("不能有特殊字符")):o()},200)},trigger:"blur"}],sendTime:[{required:!0,message:"请选择日期",trigger:"change"}],couponGroupId:[{required:!0,message:"请选择优惠券套餐",trigger:"blur"}],couponType:[{required:!0,message:"请选择优惠券类型",trigger:"blur"}]},couponIds:[{required:!0,message:"请选择优惠券",trigger:"change"}],userPhoneRules:{importUserPhone:[{validator:t,trigger:"click"}]},blackPhoneRules:{sheildUserPhone:[{validator:t,trigger:"click"}]}}},mounted:function(){this.init()},methods:{init:function(){var e=this;if(window.parent.onscroll=function(t){e.scrollMsg()},this.myListData=rootList||{},this.taskId=rootTaskId||"",console.log("myListData..",this.myListData),""!=this.taskId){this.form.taskName=this.myListData.task_name,this.form.sendTime=this.myListData.send_time,this.phoneListData=this.myListData.mobileList;var t=this.myListData.mobile_file_url||"",o=""!=t?t.split("/").pop():"",a=this.myListData.black_mobile_file_url||"",l=""!=a?a.split("/").pop():"";""!=t&&(this.files=[{name:o,url:rootCoffeeStieUrl+t}]),""!=a&&(this.filesBlack=[{name:l,url:rootCoffeeStieUrl+a}]);for(var s=0;s<this.phoneListData.length;s++){var i=this.guid(),r=this.phoneListData[s];this.form.phoneNumbersTextArea.push({data:r,guid:i})}this.blackPhoneListData=this.myListData.blackMobileList;for(var c=0;c<this.blackPhoneListData.length;c++){var u=this.guid(),p=this.blackPhoneListData[c];this.form.blacklistphoneNumTextArea.push({data:p,guid:u})}this.uploadData.oldFilePath=t,this.uploadBlackData.oldFilePath=a,this.mobileUrl=t,this.blackMobileUrl=a,0==this.myListData.coupon_id_num_map.length&&""!=this.myListData.coupon_group_id?(console.log("编辑时类型为优惠券套餐"),this.form.couponType="2",this.form.couponGroupId=this.myListData.coupon_group_id):(console.log("编辑时类型为优惠券"),this.form.couponType="1",this.form.couponGradient=this.myListData.coupon_id_num_map)}n.a.get(this.getCouponUrl).then(function(t){var o=t.data;for(var a in o)""==!a&&e.couponGroupOptions.push({value:a,label:o[a]})}).catch(function(t){e.alertMsg(t)}),n.a.get(this.getCouponIdsUrl).then(function(t){var o=t.data;for(var a in o)""==!a&&e.couponGroupIdsOptions.push({value:a,label:o[a]})}).catch(function(t){e.alertMsg(t)}),n.a.get(this.userSelectTaskUrl).then(function(t){for(var o=t.data,a=0;a<o.length;a++)""!=o[a].id&&e.userSelectTaskOptions.push({value:o[a].id,label:o[a].name});""!=e.taskId&&e.userSelectTaskOptions.find(function(t){return t.value==e.myListData.selection_task_id})&&(e.form.userSelectionTask=e.myListData.selection_task_id)}).catch(function(t){e.alertMsg(t)})},addCouponGradient:function(e){console.log(999),this.form.couponGradient.push({id:"",num:"1"}),console.log(this.form.couponGradient)},delCouponGradient:function(e){this.form.couponGradient.splice(e,1)},submitForm:function(e){var t=this;console.log("时间日期###.."+this.form.sendTime+"***"),this.$refs[e].validate(function(e){if(!e)return!1;t.form.sendTime<Date.now()+18e4?t.alertMsg("发送时间不能早于当前时间"):t.phoneListData.length>0||""!=t.form.userSelectionTask||""!=t.mobileUrl?t.submitFormAction():t.alertMsg("用户筛选任务或手机号，至少需要有其中一项才可以提交任务")})},submitFormAction:function(){var e=this;if(!this.submitFlag)return!1;this.submitFlag=!1,2==this.form.couponType?this.form.couponGradient=[{id:"",num:"1"}]:this.form.couponGroupId="",console.log("id",this.form.couponGradient);var t=this.submitFormUrl,o={id:this.taskId,task_name:this.form.taskName,selection_task_id:this.form.userSelectionTask,coupon_group_id:this.form.couponGroupId,coupon_id_num_map:this.form.couponGradient,send_time:this.form.sendTime,mobileList:this.phoneListData,blackMobileList:this.blackPhoneListData,mobileUrl:this.mobileUrl,blackMobileUrl:this.blackMobileUrl};console.log("传到后台参数",o);n.a.post(t,o,{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"}).then(function(t){var o=t.data;console.log("data.."+o),0==o?(e.alertMsg("提交失败"),e.submitFlag=!0):(e.alertMsg("发券任务提交成功！","success"),window.setTimeout(function(){window.location.href="/index.php/coupon-send-task/index"},1e3))}).catch(function(t){e.alertMsg(t),e.submitFlag=!0})},resetForm:function(e){this.$refs[e].resetFields(),this.clearUserPhone(),this.clearBlackPhone()},handleExceed:function(e,t){this.alertMsg("请删除当前文件后再上传新的文件","warning")},onRemoveTxt:function(e,t){console.log("remove txt"),this.uploadData.oldFilePath="",this.mobileUrl="",this.uploadTxtCallbackInfo=""},onRemoveBlack:function(e,t){console.log("remove black"),this.uploadBlackData.oldFilePath="",this.blackMobileUrl="",this.uploadBlackTxtCallbackInfo=""},onBeforeUpload:function(e){console.log("before");var t="text/plain"===e.type,o=e.size/1024/1024<1;return t||this.alertMsg("上传文件只能是txt格式!"),o||this.alertMsg("上传文件大小不能超过 1MB!"),t&&o},uploadSuccess:function(e,t,o){var a=e.data||{},l=a.noExistsList||"",s=a.filePath||"";this.uploadTxtCallbackInfo=l,this.mobileUrl=s},uploadSuccessBlack:function(e,t,o){var a=e.data||{},l=a.noExistsList||"",s=a.filePath||"";this.uploadBlackTxtCallbackInfo=l,this.blackMobileUrl=s},uploadError:function(e,t,o){console.log("上传失败，请重试！")},deletephoneNumbers:function(e){this.form.phoneNumbersTextArea.splice(e,1),this.phoneListData.splice(e,1)},deleteBlackNumbers:function(e){this.form.blacklistphoneNumTextArea.splice(e,1),this.blackPhoneListData.splice(e,1)},clearUserPhone:function(){this.userPhoneForm.importUserPhone="",this.form.phoneNumbersTextArea=[],this.phoneListData=[]},clearBlackPhone:function(){this.blackPhoneForm.sheildUserPhone="",this.form.blacklistphoneNumTextArea=[],this.blackPhoneListData=[]},addTaskVerifyPhone:function(){var e=this;this.$refs.formUserPhone.validate(function(t){if(!t)return console.log("phone wrong.."),!1;var o=e.userPhoneForm.importUserPhone;e.phoneListData.find(function(e){return e==o})?e.alertMsg("请勿重复添加手机号码"):e.addTaskVerifyPhoneAction()})},addTaskVerifyPhoneAction:function(){var e=this,t=new URLSearchParams;t.append("check_type",1),t.append("mobile",this.userPhoneForm.importUserPhone),t.append("build_name",""),t.append("company_name",""),n.a.post(this.checkLegalUrl,t).then(function(t){if(t.data){var o=e.guid(),a=e.userPhoneForm.importUserPhone;e.form.phoneNumbersTextArea.push({data:a,guid:o}),e.phoneListData.push(a),e.userPhoneForm.importUserPhone=""}else e.alertMsg("手机号不存在")}).catch(function(e){console.log("inputVerifyPhoneNumber error.."+e)})},addBlackVerifyPhone:function(){var e=this;this.$refs.formBlackPhone.validate(function(t){if(!t)return console.log("phone wrong.."),!1;var o=e.blackPhoneForm.sheildUserPhone;e.blackPhoneListData.find(function(e){return e==o})?e.alertMsg("请勿重复添加手机号码"):e.addTaskVerifyBlackPhoneAction()})},addTaskVerifyBlackPhoneAction:function(){var e=this,t=new URLSearchParams;t.append("check_type",1),t.append("mobile",this.blackPhoneForm.sheildUserPhone),t.append("build_name",""),t.append("company_name",""),n.a.post(this.checkLegalUrl,t).then(function(t){if(t.data){var o=e.guid(),a=e.blackPhoneForm.sheildUserPhone;e.form.blacklistphoneNumTextArea.push({data:a,guid:o}),e.blackPhoneListData.push(a),e.blackPhoneForm.sheildUserPhone=""}else e.alertMsg("手机号不存在")}).catch(function(e){console.log("blackPhoneNumber error.."+e)})},backToList:function(){window.setTimeout(function(){window.location.href="/index.php/coupon-send-task/index"},300)},alertMsg:function(e,t){var o=t||"error";this.$message({message:e,duration:3600,type:o}),this.scrollMsg()},scrollMsg:function(){if(self!=top){var e=window.parent.document.documentElement.scrollTop||window.parent.document.body.scrollTop-50,t=document.getElementsByClassName("el-message")[0];t&&(t.style.cssText="top: "+e+"px;z-index:1000;")}},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"content-body"},[o("div",{staticClass:"line-title"},[e._v("发券任务添加")]),e._v(" "),o("el-main",[o("el-form",{ref:"form",attrs:{"label-position":e.labelPosition,model:e.form,rules:e.rules,size:"small","label-width":"120px"}},[o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:"发券任务名称",prop:"taskName"}},[o("el-input",{model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName",t)},expression:"form.taskName"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:8,offset:4}},[o("el-form-item",{attrs:{label:"发送时间",prop:"sendTime"}},[o("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期时间","picker-options":e.sendTimePickerOption},model:{value:e.form.sendTime,callback:function(t){e.$set(e.form,"sendTime",t)},expression:"form.sendTime"}})],1)],1)],1),e._v(" "),o("div",[o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"优惠券类型",prop:"couponType"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.couponType,callback:function(t){e.$set(e.form,"couponType",t)},expression:"form.couponType"}},[o("el-option",{attrs:{label:"优惠券",value:"1"}}),e._v(" "),o("el-option",{attrs:{label:"优惠券套餐",value:"2"}})],1)],1)],1)],1)],1),e._v(" "),e._l(e.form.couponGradient,function(t,a){return 1==e.form.couponType?o("div",{key:a},[o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:"优惠券",prop:"couponGradient."+a+".id",rules:e.couponIds,id:"couponIds"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:t.id,callback:function(o){e.$set(t,"id",o)},expression:"item.id"}},e._l(e.couponGroupIdsOptions,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{label:"数量："}},[o("el-input",{attrs:{type:"number",min:"1",value:"1"},model:{value:t.num,callback:function(o){e.$set(t,"num",o)},expression:"item.num"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:6}},[0!=a?o("i",{staticClass:"el-icon-remove-outline iconButton",on:{click:function(t){e.delCouponGradient(a)}}}):e._e(),e._v(" "),0==a?o("i",{staticClass:"el-icon-circle-plus-outline iconButton",on:{click:e.addCouponGradient}}):e._e()])],1)],1):e._e()}),e._v(" "),2==e.form.couponType?o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"优惠券套餐",prop:"couponGroupId"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.form.couponGroupId,callback:function(t){e.$set(e.form,"couponGroupId",t)},expression:"form.couponGroupId"}},e._l(e.couponGroupOptions,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1):e._e(),e._v(" "),o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"用户筛选任务",prop:"userSelectionTask"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.form.userSelectionTask,callback:function(t){e.$set(e.form,"userSelectionTask",t)},expression:"form.userSelectionTask"}},e._l(e.userSelectTaskOptions,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:16}},[o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:14}},[o("el-form",{ref:"formUserPhone",attrs:{"label-position":e.labelPosition,model:e.userPhoneForm,rules:e.userPhoneRules,size:"small","label-width":"120px"}},[o("el-form-item",{attrs:{prop:"importUserPhone",label:"手机号"}},[o("el-input",{attrs:{type:"number"},model:{value:e.userPhoneForm.importUserPhone,callback:function(t){e.$set(e.userPhoneForm,"importUserPhone",t)},expression:"userPhoneForm.importUserPhone"}})],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:10}},[o("el-button",{attrs:{icon:"el-icon-circle-plus-outline"},on:{click:e.addTaskVerifyPhone}},[e._v("加入")]),e._v(" "),o("el-button",{attrs:{icon:"el-icon-delete"},on:{click:e.clearUserPhone}},[e._v("清空")])],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:20,offset:4}},[o("div",{staticClass:"phoneNameBox"},e._l(e.form.phoneNumbersTextArea,function(t,a){return o("el-row",{key:t.guid,staticClass:"phoneNameText"},[o("el-col",{attrs:{span:20}},[o("span",[e._v(e._s(t.data))])]),e._v(" "),o("el-col",{attrs:{span:4}},[o("i",{staticClass:"el-icon-delete",on:{click:function(t){e.deletephoneNumbers(a)}}})])],1)}))])],1)],1),e._v(" "),o("el-col",{attrs:{span:6,offset:1}},[o("el-upload",{attrs:{name:"uploadPhoneTxt",action:e.uploadActionUrl,data:e.uploadData,"on-error":e.uploadError,"on-success":e.uploadSuccess,"on-remove":e.onRemoveTxt,"before-upload":e.onBeforeUpload,accept:"text/plain",limit:1,"on-exceed":e.handleExceed,"file-list":e.files}},[o("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v('请上传txt格式文件，手机号码以空格或回车符或逗号","分隔')])],1),e._v(" "),o("div",{staticClass:"uploadTxtCallback"},[e._v(e._s(e.uploadTxtCallbackInfo))])],1)],1),e._v(" "),o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:16}},[o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:14}},[o("el-form",{ref:"formBlackPhone",attrs:{"label-position":e.labelPosition,model:e.blackPhoneForm,rules:e.blackPhoneRules,size:"small","label-width":"120px"}},[o("el-form-item",{attrs:{prop:"sheildUserPhone",label:"黑名单"}},[o("el-input",{attrs:{type:"number"},model:{value:e.blackPhoneForm.sheildUserPhone,callback:function(t){e.$set(e.blackPhoneForm,"sheildUserPhone",t)},expression:"blackPhoneForm.sheildUserPhone"}})],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:10}},[o("el-button",{attrs:{icon:"el-icon-circle-plus-outline"},on:{click:e.addBlackVerifyPhone}},[e._v("加入")]),e._v(" "),o("el-button",{attrs:{icon:"el-icon-delete"},on:{click:e.clearBlackPhone}},[e._v("清空")])],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:20,offset:4}},[o("div",{staticClass:"phoneNameBox"},e._l(e.form.blacklistphoneNumTextArea,function(t,a){return o("el-row",{key:t.guid,staticClass:"phoneNameText"},[o("el-col",{attrs:{span:20}},[o("span",[e._v(e._s(t.data))])]),e._v(" "),o("el-col",{attrs:{span:4}},[o("i",{staticClass:"el-icon-delete",on:{click:function(t){e.deleteBlackNumbers(a)}}})])],1)}))])],1)],1),e._v(" "),o("el-col",{attrs:{span:6,offset:1}},[o("el-upload",{attrs:{name:"uploadBlackTxt",action:e.uploadActionUrl,data:e.uploadBlackData,"on-error":e.uploadError,"on-success":e.uploadSuccessBlack,"before-upload":e.onBeforeUpload,"on-remove":e.onRemoveBlack,accept:"text/plain",limit:1,"on-exceed":e.handleExceed,"file-list":e.filesBlack}},[o("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v('请上传txt格式文件，手机号码以空格或回车符或逗号","分隔')])],1),e._v(" "),o("div",{staticClass:"uploadTxtCallback"},[e._v(e._s(e.uploadBlackTxtCallbackInfo))])],1)],1),e._v(" "),o("el-form-item",{staticClass:"div_center",attrs:{size:"medium"}},[o("el-button",{on:{click:e.backToList}},[e._v("取消任务")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("form")}}},[e._v("提交任务")])],1)],2)],1)],1)},staticRenderFns:[]};var c=o("Z0/y")(i,r,!1,function(e){o("WQfk")},null,null).exports;a.default.use(l.a);var u=new l.a({routes:[{path:"/",name:"CouponSendTask",component:c}]}),p=o("epGn"),m=o.n(p),d=(o("qbEQ"),{render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]});var h=o("Z0/y")({name:"App"},d,!1,function(e){o("QFIt")},null,null).exports;a.default.use(m.a),new a.default({el:"#app",router:u,components:{App:h},template:"<App/>"})},QFIt:function(e,t){},WQfk:function(e,t){},qbEQ:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.1a796d03f19071559205.js.map