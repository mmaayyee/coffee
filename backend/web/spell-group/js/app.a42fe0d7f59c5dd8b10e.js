webpackJsonp([1],{NHnr:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r("lRwf"),i=r.n(o),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var s=r("C7Lr")(null,a,!1,function(t){r("pr/d")},null,null).exports,l=r("FmsF"),n=r("3cXf"),c=r.n(n),u=r("aozt"),m=r.n(u),p={data:function(){var t=function(t,e,r){setTimeout(function(){""!=e?/^[0-9]*[1-9][0-9]*$/.test(e)||""==e||r(new Error("请输入大于0的正整数")):r(new Error("请输入正整数")),r()},200)};return{form:{activityId:"",mainTitle:"",subTitle:"",expireTime:[],status:"1",selectType:"",conferenceTime:"",totalDrinks:"",originalPrice:"",selectProduct:"",newUserType:"1",activityGradient:[{tuxedo_num:"",group_price:""}],commodityGradient:[{cf_product_id:"",group_attached_num:""}]},typeList:[{name:"新手团",value:"1"},{name:"老带新",value:"2"},{name:"全民参与",value:"3"}],rules:{mainTitle:[{required:!0,message:"请输入活动主标题",trigger:"blur"}],expireTime:[{required:!0,message:"请选择日期",trigger:"change"}],selectType:[{required:!0,message:"请选择类型",trigger:"change"}],conferenceTime:[{required:!0,message:"请输入开团时长(可输入一位小数)",trigger:"blur"},{validator:function(t,e,r){setTimeout(function(){""==e?r(new Error("请输入开团时长(可输入一位小数)")):/([1-9]+[0-9]*|0)(\\.[\\d]+)?/.test(e)?e<=0?r(new Error("请输入正数")):/^[0-9]*[1-9][0-9]*$/.test(e)||e.toString().split(".").length>1&&e.toString().split(".")[1].length>1&&r(new Error("最多输入一位小数")):r(new Error("请输入数值型")),r()},200)}}],totalDrinks:[{validator:function(t,e,r){setTimeout(function(){""!=e&&(/^[0-9]*[1-9][0-9]*$/.test(e)||""==e||r(new Error("请输入大于0的正整数"))),r()},200)}}]},priceNumRules:[{required:!0,message:"请输入价格",trigger:"blur"},{validator:function(t,e,r){setTimeout(function(){""==e?r(new Error("请输入价格")):/([1-9]+[0-9]*|0)(\\.[\\d]+)?/.test(e)?e<=0?r(new Error("请输入正数")):/^[0-9]*[1-9][0-9]*$/.test(e)||e.toString().split(".").length>1&&e.toString().split(".")[1].length>2&&r(new Error("请保留两位小数")):r(new Error("请输入数值型")),r()},200)}}],tuxedoNum:[{required:!0,message:"请输入参团人数",trigger:"blur"},{validator:t}],productNum:[{required:!0,message:"请输入商品数量",trigger:"blur"},{validator:t}],selectProduct:[{required:!0,message:"请选择商品"}],productList:rootData.data.coffee_product,uploadActionUrl:rootCoffeeStieUrl+"group-booking-api/upload-banner-files.html",submitUrl:rootCoffeeStieUrl+"group-booking-api/add-group.html",checkFormUrl:rootCoffeeStieUrl+"group-booking-api/get-title-repeat.html",uploadBannerData:{},uploadBannerCallbackInfo:"",filesBanner:[],bannerPhotoUrl:"",uploadProData:{},uploadProCallbackInfo:"",filesProduct:[],proPhotoUrl:[]}},mounted:function(){this.init()},methods:{init:function(){"{}"!==c()(rootData.data.details)&&this.render()},render:function(){var t=rootData.data.details;this.form.activityId=t.activity_id,this.form.mainTitle=t.main_title,this.form.subTitle=t.subhead,this.form.expireTime=[t.begin_time,t.end_time],this.form.status=t.status.toString(),console.log(this.form.status),this.form.selectType=t.type.toString();this.typeList.find(function(e){return e.value===t.type}),this.form.newUserType=t.new_type.toString(),this.form.conferenceTime=t.duration,this.form.activityGradient=t.price_ladder,this.form.totalDrinks=t.drink_num,this.form.commodityGradient=t.drink_ladder,this.bannerPhotoUrl=t.activity_img;var e=t.activity_img||"",r=""!=e?e.split("/").pop():"";""!=e&&(this.filesBanner=[{name:r,url:e}]),this.proPhotoUrl=t.activity_details_img,console.log(this.proPhotoUrl);var o="",i=t.activity_details_img;for(var a in i){var s=i[a];""!=s&&(o=s.split("/").pop(),this.filesProduct.push({name:o,url:s}))}},selectType:function(){"3"==this.form.selectType&&(this.form.newUserType=0),console.log("选择类型",this.form.selectType)},deleteLadder:function(t){this.form.activityGradient.length>1&&this.form.activityGradient.splice(t,1)},addLadder:function(){this.form.activityGradient.push({tuxedo_num:"",group_price:""})},deleteProductLadder:function(t){this.form.commodityGradient.length>1&&this.form.commodityGradient.splice(t,1)},addProductLadder:function(){this.form.commodityGradient.push({cf_product_id:"",group_attached_num:""})},alertMsg:function(t,e){var r=e||"error";this.$message({message:t,duration:3600,type:r}),this.scrollMsg()},scrollMsg:function(){if(self!=top){var t=window.parent.document.documentElement.scrollTop||window.parent.document.body.scrollTop-50,e=document.getElementsByClassName("el-message")[0];e&&(e.style.cssText="top: "+t+"px;z-index:1000;")}},uploadBannerSuccess:function(t,e,r){console.log("商品图片上传"),this.alertMsg("上传成功","success");var o=t.data||{};console.log("商品图片接收数据",o),console.log("商品图片上传路径",o.filePath);var i=o.noExistsList||"",a=o.filePath||"";this.bannerPhotoUrl=a,this.uploadBannerCallbackInfo=i,this.filesBanner.length=1},uploadError:function(t,e,r){this.alertMsg("上传失败，请重试！")},onBannerRemove:function(t,e){this.bannerPhotoUrl="",this.filesBanner=[]},onProRemove:function(t,e){for(var r in this.proPhotoUrl=[],e)this.proPhotoUrl.push(e[r].url);console.log(this.proPhotoUrl)},onBeforeUpload:function(t){var e="image/jpeg"===t.type||"image/gif",r=t.size/1024/200<1,o=t.size/1024;return console.log("上传图片大小",o),e||this.alertMsg("上传文件只能是图片格式!"),r||this.alertMsg("上传文件大小不能超过 200k!"),e&&r},handleExceed:function(t,e){this.alertMsg("图片已达上限请删除当前图片再上传新的图片","warning")},uploadProSuccess:function(t,e,r){console.log("商品详情上传"),this.alertMsg("上传成功！","success");var o=t.data||{};console.log("接收的上传数据",o),console.log("上传路径",o.filePath);var i=o.noExistsList||"",a=o.filePath||"";console.log("详情上传路径",a),this.proPhotoUrl.push(a),this.uploadProCallbackInfo=i,this.filesProduct.length=1},submitForm:function(t){var e=this;this.$refs[t].validate(function(t,r){if(!t){for(var o in console.log("验证失败"),r){"mainTitle"!=o&&"expireTime"!=o&&"selectType"!=o&&"conferenceTime"!=o||e.rules[o][0].message&&(document.getElementById(o).scrollIntoView(),e.alertMsg(e.rules[o][0].message));break}return!1}return console.log("验证通过"),e.filesBanner.length<=0?(e.alertMsg("请上传商品图片"),!1):e.proPhotoUrl.length>10?(e.alertMsg("详情图片超过上限"),!1):void("{}"!==c()(rootData.data.details)?e.form.mainTitle!==rootData.data.details.main_title?(console.log("编辑时修改了标题,检测标题"),e.submitBefore()):(console.log("编辑时未修改标题"),e.submitFormAction()):(console.log("添加时检测标题"),e.submitBefore()))})},resetForm:function(t){window.location.href="/group-activity/index"},submitBefore:function(){var t=this;m.a.get(this.checkFormUrl,{params:{main_title:this.form.mainTitle}}).then(function(e){e.data?t.alertMsg("套餐名称不能重复!"):t.submitFormAction()}).catch(function(e){t.alertMsg(e)})},submitFormAction:function(){var t=this,e=this.submitUrl,r={activity_id:this.form.activityId,main_title:this.form.mainTitle,subhead:this.form.subTitle,begin_time:this.form.expireTime[0],end_time:this.form.expireTime[1],status:this.form.status,type:this.form.selectType,new_type:this.form.newUserType,duration:this.form.conferenceTime,price_ladder:this.form.activityGradient,drink_num:this.form.totalDrinks,drink_ladder:this.form.commodityGradient,activity_img:this.bannerPhotoUrl,activity_details_img:this.proPhotoUrl};m.a.post(e,r).then(function(e){if("1"==e.data.state){var r=""==t.form.activityId?"1":"2";return m.a.get("/activity-combin-package-assoc/create-activity-log?type="+r+"&moduleType=2")}t.alertMsg("保存失败")}).then(function(e){t.alertMsg("保存成功","success"),setTimeout(function(){window.location.href="/group-activity/index"},2e3)}).catch(function(e){t.alertMsg(e)})}},compontents:{}},d={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content-body"},[r("div",{staticClass:"line-title"},[t._v("添加社交游戏")]),t._v(" "),r("el-form",{ref:"form",attrs:{model:t.form,"label-width":"140px",rules:t.rules}},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12,offset:0}},[r("el-form-item",{attrs:{label:"活动主标题：",prop:"mainTitle",id:"mainTitle"}},[r("el-input",{model:{value:t.form.mainTitle,callback:function(e){t.$set(t.form,"mainTitle","string"==typeof e?e.trim():e)},expression:"form.mainTitle"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12,offset:0}},[r("el-form-item",{attrs:{label:"活动副标题：",id:"subTitle"}},[r("el-input",{model:{value:t.form.subTitle,callback:function(e){t.$set(t.form,"subTitle","string"==typeof e?e.trim():e)},expression:"form.subTitle"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12,offset:0}},[r("el-form-item",{attrs:{label:"有效期：",prop:"expireTime",id:"expireTime"}},[r("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.form.expireTime,callback:function(e){t.$set(t.form,"expireTime",e)},expression:"form.expireTime"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"状态："}},[r("el-radio",{attrs:{label:"1"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v("上线")]),t._v(" "),r("el-radio",{attrs:{label:"0"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v("下线")])],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"类型：",prop:"selectType",id:"selectType"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:t.selectType},model:{value:t.form.selectType,callback:function(e){t.$set(t.form,"selectType",e)},expression:"form.selectType"}},t._l(t.typeList,function(t){return r("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})}),1)],1)],1)],1),t._v(" "),1==t.form.selectType?r("el-row",{attrs:{gutter:10}},[r("el-col",{staticClass:"row-type",attrs:{span:12}},[t._v("开团用户：新用户  参团用户：新用户")]),t._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"新用户类型："},model:{value:t.form.newUserType,callback:function(e){t.$set(t.form,"newUserType",e)},expression:"form.newUserType"}},[r("el-radio",{attrs:{label:"1"},model:{value:t.form.newUserType,callback:function(e){t.$set(t.form,"newUserType",e)},expression:"form.newUserType"}},[t._v("无购买用户")]),t._v(" "),r("el-radio",{attrs:{label:"2"},model:{value:t.form.newUserType,callback:function(e){t.$set(t.form,"newUserType",e)},expression:"form.newUserType"}},[t._v("无付费购买")])],1)],1)],1):t._e(),t._v(" "),2==t.form.selectType?r("el-row",{attrs:{gutter:10}},[r("el-col",{staticClass:"row-type",attrs:{span:12}},[t._v("开团用户：老用户  参团用户：新用户")]),t._v(" "),r("el-col",[r("el-form-item",{attrs:{label:"新用户类型："}},[r("el-radio",{attrs:{label:"1"},model:{value:t.form.newUserType,callback:function(e){t.$set(t.form,"newUserType",e)},expression:"form.newUserType"}},[t._v("无购买用户")]),t._v(" "),r("el-radio",{attrs:{label:"2"},model:{value:t.form.newUserType,callback:function(e){t.$set(t.form,"newUserType",e)},expression:"form.newUserType"}},[t._v("无付费购买")])],1)],1)],1):t._e(),t._v(" "),3==t.form.selectType?r("el-row",{attrs:{gutter:10}},[r("el-col",{staticClass:"row-type",attrs:{span:12}},[t._v("开团用户：任何用户  参团用户：任何用户")])],1):t._e(),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"开团时长(小时)：",prop:"conferenceTime",id:"conferenceTime"}},[r("el-input",{model:{value:t.form.conferenceTime,callback:function(e){t.$set(t.form,"conferenceTime","string"==typeof e?e.trim():e)},expression:"form.conferenceTime"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:2}},[r("div",{staticClass:"sub-title",staticStyle:{width:"120px","margin-right":"20px"}},[t._v("梯度管理：")])]),t._v(" "),r("el-col",{staticStyle:{"padding-left":"60px"},attrs:{span:20}},t._l(t.form.activityGradient,function(e,o){return r("div",{key:o},[r("div",{staticClass:"text activity",staticStyle:{"margin-bottom":"20px"}},[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"参团人数: ",prop:"activityGradient."+o+".tuxedo_num",rules:t.tuxedoNum,id:"tuxedoNum"}},[r("el-input",{staticStyle:{width:"80px"},attrs:{type:"number",size:"small",min:"1"},model:{value:e.tuxedo_num,callback:function(r){t.$set(e,"tuxedo_num",r)},expression:"item.tuxedo_num"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"拼团价格: ",prop:"activityGradient."+o+".group_price",rules:t.priceNumRules,id:"priceNumRules"}},[r("el-input",{staticStyle:{width:"80px"},attrs:{size:"small"},model:{value:e.group_price,callback:function(r){t.$set(e,"group_price",r)},expression:"item.group_price"}}),t._v("   \r\n\t\t\t                 ")],1)],1),t._v(" "),r("el-col",{staticClass:"btn-icon",attrs:{span:3}},[0!=o?r("i",{staticClass:"el-icon-remove-outline",staticStyle:{"font-size":"20px",position:"relative",top:"2px",cursor:"pointer"},on:{click:function(e){return t.deleteLadder(o)}}}):t._e(),t._v(" "),0==o?r("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"font-size":"20px",position:"relative",top:"2px",cursor:"pointer"},on:{click:t.addLadder}}):t._e()])],1)])}),0)],1),t._v(" "),r("div",{staticClass:"line-title"},[t._v("商品设置")]),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12,offset:0}},[r("el-form-item",{attrs:{label:"最多成团数：",prop:"totalDrinks",id:"totalDrinks"}},[r("el-input",{attrs:{type:"number",min:"1"},model:{value:t.form.totalDrinks,callback:function(e){t.$set(t.form,"totalDrinks","string"==typeof e?e.trim():e)},expression:"form.totalDrinks"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:2}},[r("div",{staticClass:"sub-title",staticStyle:{width:"120px","margin-right":"20px"}},[t._v("选择商品：")])]),t._v(" "),r("el-col",{staticStyle:{"padding-left":"45px"},attrs:{span:18}},t._l(t.form.commodityGradient,function(e,o){return r("div",{key:o},[r("div",{staticClass:"text",staticStyle:{"margin-bottom":"20px"}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"选择商品：",prop:"commodityGradient."+o+".cf_product_id",rules:t.selectProduct,id:"selectProduct"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.cf_product_id,callback:function(r){t.$set(e,"cf_product_id",r)},expression:"item.cf_product_id"}},t._l(t.productList,function(t){return r("el-option",{key:t.cf_product_id,attrs:{label:t.cf_product_name,value:t.cf_product_id}})}),1)],1)],1),t._v(" "),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"商品数量:",prop:"commodityGradient."+o+".group_attached_num",rules:t.productNum,id:"productNum"}},[r("el-input",{staticStyle:{width:"80px"},attrs:{type:"number",size:"small",min:"1"},model:{value:e.group_attached_num,callback:function(r){t.$set(e,"group_attached_num",r)},expression:"item.group_attached_num"}})],1)],1),t._v(" "),r("el-col",{staticClass:"btn-icon",attrs:{span:3}},[0!=o?r("i",{staticClass:"el-icon-remove-outline",staticStyle:{"font-size":"20px",position:"relative",top:"2px",cursor:"pointer"},on:{click:function(e){return t.deleteProductLadder(o)}}}):t._e(),t._v(" "),0==o?r("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"font-size":"20px",position:"relative",top:"2px",cursor:"pointer"},on:{click:t.addProductLadder}}):t._e()])],1)])}),0)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"商品图片：",id:"uploadBannerPhoto"}},[r("el-upload",{attrs:{name:"activity_img",action:t.uploadActionUrl,data:t.uploadBannerData,"on-error":t.uploadError,"on-success":t.uploadBannerSuccess,"before-upload":t.onBeforeUpload,"on-remove":t.onBannerRemove,accept:"image/jpeg,image/gif,image/png",limit:1,"on-exceed":t.handleExceed,"file-list":t.filesBanner,"list-type":"picture"}},[r("el-button",{attrs:{size:"small",type:"success"}},[t._v("上传图片")]),t._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("请上传图片格式文件")])],1),t._v(" "),r("div",{staticClass:"uploadBannerCallback"},[t._v(t._s(t.uploadBannerCallbackInfo))])],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"详情图片："}},[r("el-upload",{attrs:{name:"activity_details_img",action:t.uploadActionUrl,data:t.uploadProData,"on-error":t.uploadError,"on-success":t.uploadProSuccess,"before-upload":t.onBeforeUpload,"on-remove":t.onProRemove,accept:"image/jpeg,image/gif,image/png",limit:10,"file-list":t.filesProduct,"list-type":"picture","on-exceed":t.handleExceed}},[r("el-button",{attrs:{size:"small",type:"success"}},[t._v("上传图片")]),t._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("请上传图片格式文件")])],1),t._v(" "),r("div",{staticClass:"uploadBannerCallback"},[t._v(t._s(t.uploadProCallbackInfo))])],1)],1)],1),t._v(" "),r("el-form-item",{staticClass:"div-submit",attrs:{size:"medium"}},[r("el-button",{on:{click:function(e){return t.resetForm("form")}}},[t._v("返回")]),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[]};var f=r("C7Lr")(p,d,!1,function(t){r("lRAp")},null,null).exports;i.a.use(l.a);var v=new l.a({routes:[{path:"/",redirect:"/add"},{path:"/add",name:"addSpellGoods",component:f}]});i.a.config.productionTip=!1,new i.a({el:"#app",router:v,components:{App:s},template:"<App/>"})},lRAp:function(t,e){},lRwf:function(t,e){t.exports=Vue},"pr/d":function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.a42fe0d7f59c5dd8b10e.js.map